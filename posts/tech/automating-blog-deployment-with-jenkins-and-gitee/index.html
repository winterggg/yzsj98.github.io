<!doctype html><html lang=en><head><meta charset=utf-8><meta name=generator content="Hugo 0.85.0"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="yzsj98"><meta property="og:url" content="https://www.yizhishuijiao.com/posts/tech/automating-blog-deployment-with-jenkins-and-gitee/"><link rel=canonical href=https://www.yizhishuijiao.com/posts/tech/automating-blog-deployment-with-jenkins-and-gitee/><link rel=apple-touch-icon href=https://www.yizhishuijiao.com/favicon.ico><link rel=icon href=https://www.yizhishuijiao.com/favicon.ico><link rel=shortcut href=https://www.yizhishuijiao.com/favicon.ico><link rel=alternate type=application/atom+xml href=https://www.yizhishuijiao.comindex.xml title=一只水饺的笔记><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.yizhishuijiao.com"},"articleSection":"posts","name":"使用 Jenkins 和 Gitee 自动部署博客","headline":"使用 Jenkins 和 Gitee 自动部署博客","description":"本文介绍如何在自建服务器上使用 Jenkins 和 Gitee 部署博客，当 Git 仓库发生变更后能自动部署并发布博客。本文以 Hexo 为例，其他静态网站生成器的操作类似。\n 环境信息    环境 版本     操作系统 CentOS 7   Jenkins 2.277.4   JDK 1.8.0_282   Nginx 1.18.0   Git Host Gitee    配置 Jenkins 安装 Jenkins 参考 官方文档 安装即可， CentOS 的步骤如下 ：\n# 添加 Yum 源 sudo wget -O \/etc\/yum.repos.d\/jenkins.repo https:\/\/pkg.jenkins.io\/redhat-stable\/jenkins.repo # 导入密钥 sudo rpm --import https:\/\/pkg.jenkins.io\/redhat-stable\/jenkins.io.key sudo yum install -y jenkins （可选）Jenkins 默认端口为 8080，可以在配置文件里修改：","inLanguage":"en-US","author":"yzsj98","creator":"yzsj98","publisher":"yzsj98","accountablePerson":"yzsj98","copyrightHolder":"yzsj98","copyrightYear":"2021","datePublished":"2021-05-24 00:00:00 \u002b0000 UTC","dateModified":"2021-05-24 00:00:00 \u002b0000 UTC","url":"https:\/\/www.yizhishuijiao.com\/posts\/tech\/automating-blog-deployment-with-jenkins-and-gitee\/","keywords":[]}</script><title>使用 Jenkins 和 Gitee 自动部署博客</title><meta property="og:title" content="使用 Jenkins 和 Gitee 自动部署博客"><meta property="og:type" content="article"><meta property="og:description" content="本文介绍如何在自建服务器上使用 Jenkins 和 Gitee 部署博客，当 Git 仓库发生变更后能自动部署并发布博客。本文以 Hexo 为例，其他静态网站生成器的操作类似。
 环境信息    环境 版本     操作系统 CentOS 7   Jenkins 2.277.4   JDK 1.8.0_282   Nginx 1.18.0   Git Host Gitee    配置 Jenkins 安装 Jenkins 参考 官方文档 安装即可， CentOS 的步骤如下 ：
# 添加 Yum 源 sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo # 导入密钥 sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key sudo yum install -y jenkins （可选）Jenkins 默认端口为 8080，可以在配置文件里修改："><meta name=description content="本文介绍如何在自建服务器上使用 Jenkins 和 Gitee 部署博客，当 Git 仓库发生变更后能自动部署并发布博客。本文以 Hexo 为例，其他静态网站生成器的操作类似。
 环境信息    环境 版本     操作系统 CentOS 7   Jenkins 2.277.4   JDK 1.8.0_282   Nginx 1.18.0   Git Host Gitee    配置 Jenkins 安装 Jenkins 参考 官方文档 安装即可， CentOS 的步骤如下 ：
# 添加 Yum 源 sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo # 导入密钥 sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key sudo yum install -y jenkins （可选）Jenkins 默认端口为 8080，可以在配置文件里修改："><meta property="og:locale" content="zh-cn"><style>article.post h1,h2,h3,h4,h5,h6{border-bottom:1px solid #b3b3b3}.site-header{user-select:none}html{scroll-behavior:smooth}body{font-family:bree serif,noto serif sc;-webkit-font-smoothing:antialiased;margin:0 20px}code{font-family:fira code,noto serif sc;font-weight:600}article{max-width:800px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none}a:hover{font-weight:600;text-decoration:underline}.post-ads{margin:50px 0}.markdown-body{font-size:18px;max-width:100%}.markdown-body a{text-decoration:underline;text-decoration-color:#000}.markdown-body pre{padding:16px;overflow:auto;border-radius:10px}.markdown-body code{padding:.2em .4em;font-size:85%;background-color:#e2e2e2;background-color:#f6f8fa;display:inline-block;border-radius:5px}.markdown-body pre{background-color:#e2e2e2!important}.markdown-body pre>code{padding:0;font-size:100%;background-color:inherit;border:0;display:inherit}article div.highlight{overflow-x:auto}.Chinese .markdown-body{line-height:200%}.site-date-catalog{font-size:2rem}.header-title{font-size:2rem;font-weight:700;margin-top:32px;font-family:bungee shade,sans-serif}.header-title a{text-decoration:none}.header-subtitle{color:#666}.header-items{margin:5px 0;padding:0 12px}.header-item{margin:0 5px}.header-line{width:100%;border-bottom:3px solid;border-color:#000}.lang-switch{font-weight:600}#posts-list{min-height:calc(100vh - 400px)}.posts-line{font-size:1.2rem;margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-date,.site-footer,.posts-category,.site-date-catalog,.post-tags{user-select:none}.posts-category{padding:3px 0;border:#000 2px solid;border-radius:5px}.site-footer{margin-top:50px;margin-bottom:80px;display:flex;justify-content:flex-end;flex-wrap:wrap;padding:12px 0;border-width:3px;border-style:solid none;border-color:#000}.site-footer-item{margin-right:12px}.post-content img{max-width:100%;max-height:400px;display:block;margin-right:auto;margin-top:12px}.post-header{margin-bottom:15px}.post-title{margin:20px 0 5px;font-size:2rem;font-weight:600}.post-tags{display:inline;font-weight:600;padding:2px 5px;margin-right:6px;border:#000 2px solid;border-radius:5px}.post-date{color:#999}.post-author{float:right;font-weight:600}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.contents{user-select:none;position:relative;left:-2px;background-color:rgba(233,233,233,.5);width:35%;position:relative;border-width:2px;border-style:solid;border-radius:4px;border-color:#000;margin-bottom:10px;margin-top:0}.contents ol{padding-right:30px}.contents ol ol{padding-right:10px}#content-body{display:block}.contents .hide-tool{position:absolute;cursor:pointer;right:5px;top:0}.contents .content-title{font-size:1.25em;margin-left:.5em}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0}.disqus_tip{text-align:center;margin-bottom:20px;height:80px;background-color:#f6f8fa;border-radius:5px;padding:.4em .8em}.disqus_tip div.tip_words{position:relative;font-size:18px;top:50%;transform:translateY(-50%)}@media screen and (max-width:600px){.posts-line{font-size:16px}.markdown-body{font-size:16px}.post-title{font-size:2rem}.post-content p{letter-spacing:.05em}}@media screen and (max-width:48em){.posts-category{display:none}.contents .hide-tool{display:none}.contents{width:100%}}.markdown-body blockquote{box-sizing:border-box;border-left:5px solid #000;margin:20px 0;padding:0 0 0 10px;background:rgba(233,233,233,.5)}.markdown-body blockquote p{margin:0}.markdown-body>table{border-spacing:0;border-collapse:collapse;width:100%;overflow:auto}.markdown-body>table td,.markdown-body>table th{padding:0}.markdown-body>table th{font-weight:600}.markdown-body>table td,.markdown-body>table th{padding:6px 13px;border:1px solid #b3b3b3}.markdown-body>table tr{background-color:#fff;border:1px solid #ededef}.markdown-body>table tr:nth-child(2n){background-color:#f7f7f7}*::-webkit-scrollbar{width:8px;height:8px;transition:all .2s ease}*::-webkit-scrollbar-thumb{background:#595967;border-radius:1px}*::-webkit-scrollbar-track{background:#e2e2e2}html::-webkit-scrollbar,body::-webkit-scrollbar{width:8px;height:8px}</style><style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:initial;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style><link href=/index.xml rel=alternate type=application/rss+xml title=一只水饺的笔记><script async src="https://www.googletagmanager.com/gtag/js?id=G-9245MNBK1M"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-9245MNBK1M')</script><link href="https://fonts.loli.net/css?family=Bree+Serif|Bungee+Shade|Fira+Code|Noto+Serif+SC&display=swap" rel=stylesheet><script src=/js/tools.js></script></head><body><article class=post id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class="header-title start-md center-xs"><a href=/>YZSJ's Notes</a></div><div class="header-subtitle start-md center-xs">Hello, I am yzsj98</div></header><div class="row end-md center-xs header-items"></div><div class="row end-xs"></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>使用 Jenkins 和 Gitee 自动部署博客</h1><time class=post-date datetime="2021-05-24 00:00:00 UTC">24 May 2021</time>
<span class=post-date>/ @yzsj98</span></header><div class="post-content markdown-body"><div class=contents><span class=content-title>Contents</span>
<a class=hide-tool href=# onclick=toggleContents(event) class=hide>[Toggle]</a><div id=content-body><nav id=TableOfContents><ol><li><a href=#环境信息>环境信息</a></li><li><a href=#配置-jenkins>配置 Jenkins</a><ol><li><a href=#安装-jenkins>安装 Jenkins</a></li><li><a href=#jenkins-初始化>Jenkins 初始化</a></li><li><a href=#安装插件>安装插件</a></li></ol></li><li><a href=#添加-ci-任务>添加 CI 任务</a><ol><li><a href=#配置密钥可选>配置密钥（可选）</a></li><li><a href=#新建-ci-任务>新建 CI 任务</a></li></ol></li><li><a href=#其他>其他</a><ol><li><a href=#推送>推送</a></li><li><a href=#使用-githu--gitee-双仓库>使用 Githu & Gitee 双仓库</a></li></ol></li></ol></nav></div></div><blockquote><p>本文介绍如何在<code>自建服务器</code>上使用 <code>Jenkins</code> 和 <code>Gitee</code> 部署博客，当 Git 仓库发生变更后能自动部署并发布博客。本文以 Hexo 为例，其他静态网站生成器的操作类似。</p></blockquote><h2 id=环境信息>环境信息</h2><table><thead><tr><th>环境</th><th>版本</th></tr></thead><tbody><tr><td>操作系统</td><td>CentOS 7</td></tr><tr><td>Jenkins</td><td>2.277.4</td></tr><tr><td>JDK</td><td>1.8.0_282</td></tr><tr><td>Nginx</td><td>1.18.0</td></tr><tr><td>Git Host</td><td>Gitee</td></tr></tbody></table><h2 id=配置-jenkins>配置 Jenkins</h2><h3 id=安装-jenkins>安装 Jenkins</h3><p>参考 <a href=https://www.jenkins.io/doc/book/installing/linux/>官方文档</a> 安装即可， <code>CentOS</code> 的步骤如下 ：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=color:#177500># 添加 Yum 源</span>
sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
<span style=color:#177500># 导入密钥</span>
sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key

sudo yum install -y jenkins
</code></pre></div><p>（<strong>可选</strong>）Jenkins 默认端口为 8080，可以在配置文件里修改：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>vim /etc/sysconfig/jenkins
<span style=color:#177500># 修改 JENKINS_PORT=xxx 即可</span>
</code></pre></div><p>最后添加开机启动：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=color:#177500># 重载服务（由于前面修改了 Jenkins 启动脚本）</span>
sudo systemctl daemon-reload

<span style=color:#177500># 启动 Jenkins 服务</span>
sudo systemctl start jenkins

<span style=color:#177500># 将 Jenkins 服务设置为开机启动</span>
<span style=color:#177500># 由于 Jenkins 不是 Native Service，所以需要用 chkconfig 命令而不是 systemctl 命令</span>
sudo /sbin/chkconfig jenkins on
</code></pre></div><h3 id=jenkins-初始化>Jenkins 初始化</h3><p>确保所设置的端口在防火墙里已开放，浏览器访问 <code>&lt;ip>:&lt;port></code>，按照向导完成初始化。</p><h3 id=安装插件>安装插件</h3><h4 id=安装配置-nodejs-plugin>安装配置 NodeJS Plugin</h4><p>登录 Dashboard，选择 Manage Jenkins > Manage Plugins，点击 Available，安装 <code>NodeJS Plugin</code>。</p><p>然后在 Dashboard > Manage Jenkins > Global Tool Configuration 里下滑找到 NodeJS ，点击 NodeJS installations &mldr;，配置如下：</p><p><img src=assets/20210524150520_76a0e7d8becfae5da040a6086aa78027.png></p><p>选择 Node 版本，在 Global npm packages to install 里填入 <code>Hexo</code> 和 <code>Yarn</code> 依赖：</p><pre><code>hexo-cli@4.2.0 yarn --registry https://registry.npm.taobao.org/ 
</code></pre><p>点 Save 保存。</p><h4 id=安装-gitee-plugin>安装 Gitee Plugin</h4><p>由于 Github 在国内网络几乎不可用，这里把 Host 换成了 <code>Gitee</code>，因此还需要安装一个 <a href=https://plugins.jenkins.io/gitee>Gitee Plugin</a>。</p><p>Gitee 的配置参考 Gitee 的官方<a href=https://gitee.com/help/articles/4193>帮助中心</a>：</p><p>简单来说，在 Jenkins -> Manage Jenkins -> Configure System -> Gitee Configuration -> Gitee connections 里，按照文档配置如下：</p><img src=assets/20210524145442_39c755f42070956c01ec1dd6ec29bcc6.png><h2 id=添加-ci-任务>添加 CI 任务</h2><h3 id=配置密钥可选>配置密钥（可选）</h3><p>若博客代码托管在私人仓库，需要额外生成密钥对并把公钥添加到 Gitee 里。如果你的仓库是公开状态，这一步可以跳过。</p><p>切换到 Jenkins 用户：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>sudo su -s /bin/bash jenkins
</code></pre></div><p>生成密钥对：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>ssh-keygen -o
</code></pre></div><p>查看公钥并复制：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>cat ~/.ssh/id_rsa.pub
</code></pre></div><p>然后在 Gitee 网站右上角 个人头像 > 设置 > SSH公钥 里粘贴公钥，点确定保存。</p><h3 id=新建-ci-任务>新建 CI 任务</h3><h4 id=新建任务>新建任务</h4><p>接下来就可以在 Jenkins 里新建构建博客的 CI 任务了！</p><p>打开 Dashboard，点击 New Item。输入 Item name，类型选择 Freestyle project。配置页里 Gitee connection 选择之前配置的 connection。</p><p>在 Source Code Management 里选择 Git，Repository URL 里填入仓库链接，如果这个时候显示权限失败，参照上一小节配置密钥。</p><p>在 Build Triggers 里选择 <code>Build when a change is pushed to Gitee. Gitee webhook URL: http://xxxx:xxx/gitee-project/blog</code> ，注意复制这里的 webhook url，之后会用到。</p><p>然后再 Enabled Gitee triggers 里选中 <code>Push Events</code>，<code>Secret Token for Gitee WebHook</code> 里点击 Generate，同样保存备用。</p><h4 id=gitee-配置-webhook>Gitee 配置 Webhook</h4><p>之前配置的 Webhook 需要在 Gitee 上同样配置一下才能正常工作：</p><p>登陆 Gitee 后在仓库主页点击 管理 > WebHooks > 添加 WebHooks，然后填入刚刚保存的 <code>url</code> 和 <code>token</code>，保存即可。</p><h4 id=编写构建脚本>编写构建脚本</h4><p>回到任务配置页，继续添加自动构建脚本：</p><p>在 Build 里点击 Add build step，选择 Execute shell，根据网站和博客的具体情况编写构建部署命令。以 Hexo 为例，命令如下：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=color:#177500># --prod 表示不安装 devDependences</span>
yarn install --prod --registry https://registry.npm.taobao.org/

<span style=color:#177500># Hexo 生成脚本</span>
hexo clean
hexo generate

<span style=color:#177500># 部署脚本</span>
rm -rf /www/wwwroot/mysite/*
cp -a ./public/. /www/wwwroot/mysite/
</code></pre></div><blockquote><p>2021年5月28日 更新，部署 <code>mkdocs</code> 的脚本如下：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>/usr/bin/pip3.6 install -i https://pypi.tuna.tsinghua.edu.cn/simple mkdocs-material --user
/usr/bin/python3 -m mkdocs build

rm -rf /www/wwwroot/mymkdocssite/*
cp -a ./site/. /www/wwwroot/mymkdocssite/
</code></pre></div></blockquote><h4 id=测试部署>测试部署</h4><p>完成 CI 任务的创建后，回到 Project 页面，点击 Build now，观察是否一切正常。然后通过 Git 更改后 push，测试 WebHook 是否正常。</p><p>如果部署时提示权限不足，可以把网址所在的目录 owner 改为 jenkins 来解决。</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>sudo chown -R jenkins:jenkins mysite/
</code></pre></div><h2 id=其他>其他</h2><h3 id=推送>推送</h3><p>原来用 <code>Vercel</code> 的时候，每次构建完毕，<code>Vercel Bot</code> 就会给我的仓库的 Commit 评论一下，然后会收到 Github 发来的邮件，提醒构建已完成，非常好用。当然，现在这个功能也只能自己写了。因为是国内服务器，所以排除了用 Telegram 推送。搜索了一下，发现了一个通过 QQ 推送消息的网站 <a href=https://qmsg.zendee.cn/>Qmsg酱</a>，按照<a href=https://qmsg.zendee.cn/api.html>文档</a>注册配置后可以获得一个 Qmsg Key，然后就可以调用 RESTful 接口发起推送了！</p><p>配置非常简单，在构建脚本的最后添加如下命令即可：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>curl --location --request POST <span style=color:#c41a16>&#39;https://qmsg.zendee.cn/send/&lt;你的 qmsgKey&gt;&#39;</span> <span style=color:#c41a16>\
</span><span style=color:#c41a16></span>--header <span style=color:#c41a16>&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span style=color:#c41a16>\
</span><span style=color:#c41a16></span>--data-urlencode <span style=color:#c41a16>&#39;msg=itiandong.com 部署成功&#39;</span>
</code></pre></div><p>这样每次部署完成，你会收到一条 QQ 消息：</p><img src=assets/20210524153445_02bf20f485453fd849846047a77b300e.png><h3 id=使用-githu--gitee-双仓库>使用 Githu & Gitee 双仓库</h3><p>这次迁移的过程中也遇到了一些坑。最开始本来打算沿用 Github 的，但测试发现 Clone 总是出错，于是被迫改成国内的 Gitee。可以在原仓库上额外添加 Gitee 远程仓库地址，让 Github 和 Gitee 并存：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>git remote add gitee &lt;url&gt;
</code></pre></div><p>然后提交时，分别执行：</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>git push origin master
git push gitee master
</code></pre></div><p>就可以分别提交到两个仓库里了。</p></div><div class="row middle-xs"><div class=col-xs-12></div></div><div class=row><div class=col-xs-12></div></div><div style=height:50px></div><div class=post-comments><div id=disqus_thread><div class=disqus_tip><div class=tip_words>评论使用 Disqus，国内网络可能需要对 disq.us | disquscdn.com | disqus.com 启用代理。</div></div></div><script>window.addEventListener("load",()=>{(function(){var a=document,b=a.createElement("script");b.src="https://yizhishuijiao.disqus.com/embed.js",b.setAttribute("data-timestamp",+new Date),(a.head||a.body).appendChild(b)})()})</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><div class=site-footer><div class=site-footer-item><a href=/archives>Archives</a></div><div class=site-footer-item><a href=https://github.com/yzsj98 target=_blank>Github</a></div><div class=site-footer-item><a href=https://twitter.com/yizhishuijiao target=_blank>Twitter</a></div><div class=site-footer-item><a href=https://yizhishuijiao.wordpress.com target=_blank>草稿本</a></div></div></div></div></article></script><script src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js></script><script>document.querySelectorAll('.post-content img').forEach(function(a){a.parentNode.nodeName.toLowerCase()==='a'||mediumZoom(a,{margin:5,background:'rgba(255,255,255,0.8)'})})</script><script></script></body></html>